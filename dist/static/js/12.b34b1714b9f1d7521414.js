webpackJsonp([12],{"1dn/":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("Qj97"),n={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{id:"restart","element-loading-text":e.loadingText,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[i("div",{staticClass:"fl"},[i("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),e._v(" "),i("div",{staticStyle:{margin:"15px 0"}}),e._v(" "),i("el-checkbox-group",{on:{change:e.handleCheckedCitiesChange},model:{value:e.checkedCities,callback:function(t){e.checkedCities=t},expression:"checkedCities"}},e._l(e.server,function(t,s){return i("el-checkbox",{key:s,attrs:{label:t.name,border:""}},[e._v(e._s(t.name))])}),1),e._v(" "),i("div",{staticStyle:{margin:"15px 0"}}),e._v(" "),i("el-button",{staticStyle:{"margin-bottom":"20px"},attrs:{type:"primary",plain:""},on:{click:function(t){return e.sendRestart(0)}}},[e._v("启动")]),e._v(" "),i("el-button",{staticStyle:{"margin-bottom":"20px"},attrs:{type:"primary",plain:""},on:{click:function(t){return e.sendRestart(2)}}},[e._v("重新启动")])],1),e._v(" "),i("el-timeline",e._l(e.resetList,function(t,s){return i("el-timeline-item",{key:s,attrs:{timestamp:t[0].tit,placement:"top",color:t[t.length-1].color}},[i("el-card",e._l(t,function(t,s){return i("p",{key:"v"+s,staticClass:"msgP"},[e._v(e._s(t.msg))])}),0)],1)}),1)],1)},staticRenderFns:[]};var o=function(e){i("zElw")},c=i("VU/8")(s.a,n,!1,o,null,null);t.default=c.exports},Qj97:function(e,t,i){"use strict";(function(e){var s=i("mvHQ"),n=i.n(s),o=["customer","pro","monitor","mysql","mongo","mqtt","redis"];t.a={name:"restart",data:function(){return{url:this.ipNormal+"/api/v1/",loadingText:"重启中,30s",loading:!1,checkAll:!1,checkedCities:[],server:[{name:"customer"},{name:"pro"},{name:"monitor"},{name:"mysql"},{name:"mongo"},{name:"mqtt"},{name:"redis"}],isIndeterminate:!0,resetList:[],websock:null,sendMsg:"",time:null,n:30}},methods:{handleCheckAllChange:function(e){this.checkedCities=e?o:[],this.isIndeterminate=!1},handleCheckedCitiesChange:function(e){var t=e.length;this.checkAll=t===this.checkedCities.length,this.isIndeterminate=t>0&&t<o.length},sendRestart:function(e){var t=this;this.$confirm("确定执行此操作？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){t.checkedCities.includes("monitor")&&(t.checkedCities.splice(t.checkedCities.findIndex(function(e){return"monitor"===e}),1),t.checkedCities.push("monitor")),t.sendMsg=n()({server:t.checkedCities.join("-"),flag:e}),t.resetList=[],console.log(t.sendMsg),t.initWebpack()}).catch(function(){t.$message({type:"info",message:"取消输入"})})},initWebpack:function(){this.websock="ws://"+this.ipWsMonitor+"/restartTo",this.websock=new WebSocket(this.websock),this.websock.onopen=this.websocketopen,this.websock.onmessage=this.websocketonmessage,this.websock.onclose=this.websocketclose,this.websock.onerror=this.websocketerror},websocketopen:function(){console.log("WebSocket连接成功"),this.websocketonsend()},websocketonmessage:function(t){console.log(t.data),this.checkedCities.includes("monitor")&&1===this.checkedCities.length?(console.log(this.checkedCities.includes("monitor")),console.log(1===this.checkedCities.length),this.resetList=[]):(t.data.includes(" -> ")&&(void 0==this.resetList[0]||t.data.split(" -> ")[0]===this.resetList[this.resetList.length-1][0].tit?(void 0==this.resetList[0]?this.resetList=[[]]:this.resetList=this.resetList,this.resetList[this.resetList.length-1].push({tit:t.data.split(" -> ")[0],msg:t.data.split(" -> ")[1],color:"error"===t.data.split(" -> ")[0]?"#F56C6C":"#67C23A"})):this.resetList.push([{tit:t.data.split(" -> ")[0],msg:t.data.split(" -> ")[1],color:"error"===t.data.split(" -> ")[0]?"#F56C6C":"#67C23A"}])),console.log(this.resetList),console.log(e(".el-timeline")[0]),setTimeout(function(){e(".el-timeline")[0].scrollTop=e(".el-timeline")[0].scrollHeight},10))},websocketonsend:function(e){this.websock&&(console.log(this.sendMsg),this.websock.send(this.sendMsg))},websocketclose:function(e){console.log("WebSocket关闭"),console.log(this.checkedCities),this.getTime(),this.websock&&this.websock.close()},websocketerror:function(){console.log("WebSocket连接失败");var e=this;"#/devPageBox/restart"==location.hash&&(window.ActiveXObject||"ActiveXObject"in window)&&setTimeout(function(){e.initWebpack(),e=null},5e3)},getTime:function(){if(this.checkedCities.includes("monitor")){var t=this;this.n>0?(this.loading=!0,this.time=setTimeout(function(){clearTimeout(t.time),t.time=null,t.n--,t.loadingText="重启中,"+t.n+"s",t.getTime()},1e3)):(this.loading=!1,console.log(this.checkedCities),this.resetList.push([{tit:"monitor",msg:"restart  monitor start to exec",color:"#67C23A"},{tit:"monitor",msg:"restart  monitor result.........light_v3mysql",color:"#67C23A"}]),this.resetList.push([{tit:"end",msg:"end",color:"#67C23A"}]),setTimeout(function(){e(".el-timeline")[0].scrollTop=e(".el-timeline")[0].scrollHeight},10),console.log(this.resetList))}}},mounted:function(){},destroyed:function(){this.websocketclose("web")}}}).call(t,i("7t+N"))},zElw:function(e,t){}});