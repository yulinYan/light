webpackJsonp([18],{"1USr":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Gu7T"),i=a.n(n),o=a("fZjL"),r=a.n(o),l=a("gRE1"),s=a.n(l),u=a("XLwt"),c=a.n(u),d=a("Rnrl"),h=d.c,m={name:"LightStatistics",data:function(){return{show:{CurDayHourPower:!0,area:!0,powerByConditon:!0,historyCharts:!0},tableData:[],tableDataReport:[],clearable:!1,pickerOptions:{disabledDate:function(e){return e.getTime()>Date.now()}},getHistoryCharts:null,loading:!0,option:{color:["#3c70d7","#7ea6f2","#D4E8FF","#7DE5D2","#FEAE7B","#003399","#3366cc","#0087cb","#3399ff","#017890","#587498","#74828f","#666633","#99cccc","#a1bad0","#c25b56","#ff9933","#d0a727","#f9ca79","#d9ccb9"],tooltip:{trigger:"axis",backgroundColor:"rgba(240, 244, 251, 0.8)",textStyle:{color:"#505050",fontFamily:"Microsoft YaHei",align:"left"},axisPointer:{type:"line"}},legend:{type:"scroll",width:"70%",data:[],icon:"pin",textStyle:{fontSize:"14px",fontFamily:"Microsoft YaHei"},itemGap:30,right:10,top:"20px"},grid:{left:"40px",right:"40px",bottom:"50px"},xAxis:{data:[],type:"category",axisLine:{lineStyle:{color:"#d8d8d8"}},nameTextStyle:{fontFamily:"Microsoft YaHei",color:"#505050"},axisLabel:{color:"#707070"},axisTick:{show:!1,alignWithLabel:!1},nameGap:25,name:""},yAxis:{name:"kW·h          ",type:"value",nameGap:20,axisLine:{show:!1},axisLabel:{color:"#505050",margin:40,align:"left"},splitLine:{lineStyle:{color:"#eee"}},axisTick:{show:!1,lineStyle:{color:"#eee"}}},dataZoom:[{show:!1}],series:[]},timeValue:"datetime",timeOptiion:[{value:"year",label:"年"},{value:"month",label:"月"},{value:"date",label:"天"},{value:"datetime",label:"时"}],rangeValueStart:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()-1),rangeValueEnd:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()),selectOptions:[],areaValue:[""],time:null}},methods:{getFrom:function(){var e=this;Object(d.a)(h+"lightStatistic/find/power/zoneForm?time="+100*Math.random()).then(function(t){"success"==t.resultCode&&(e.tableData=t.data)}).catch(function(){})},cellStyle:function(e){e.row,e.column;var t=e.rowIndex,a=(e.columnIndex,{"text-align":"center","font-size":"14px",height:"60px","background-color":"#ffffff",color:"#303030"});return window.innerWidth>1660?t%2!=0&&(a["background-color"]="#f2f4f6"):window.innerWidth>1440?(a.height="52px",t%2!=0&&(a["background-color"]="#f2f4f6")):(a.height="20px",t%2!=0&&(a["background-color"]="#f2f4f6")),a},headerStyle:function(e){e.row,e.column,e.rowIndex,e.columnIndex;var t={"background-color":"#f2f4f6","font-size":"16px",color:"#101010","text-align":"center",height:"60px"};return window.innerWidth>1440?(t.height="52px",t["font-size"]="14px"):(t.height="20px",t["font-size"]="14px"),t},cellStyleReport:function(e){e.row,e.column;var t=e.rowIndex,a=(e.columnIndex,{"text-align":"center","font-size":"14px",height:"60px","background-color":"#ffffff",color:"#303030"});return window.innerWidth>1660?t%2!=0&&(a["background-color"]="#f2f4f6"):window.innerWidth>1440?(a.height="52px",t%2!=0&&(a["background-color"]="#f2f4f6")):(a.height="20px",t%2!=0&&(a["background-color"]="#f2f4f6")),a},headerStyleReport:function(e){e.row,e.column,e.rowIndex,e.columnIndex;var t={"background-color":"#f2f4f6","font-size":"16px",color:"#101010","text-align":"center",height:"60px"};return window.innerWidth>1440?(t.height="52px",t["font-size"]="14px"):(t.height="20px",t["font-size"]="14px"),t},getnumerialArea:function(){var e=this;Object(d.a)(h+"lightStatistic/power/zone/list?time="+100*Math.random()).then(function(t){if(e.$root.Bus.$emit("showLoading",!1),"success"==t.resultCode){e.selectOptions=[];var a=[];t.data.forEach(function(t,n){""!=t.zoneName&&(a=[],t.categoryGroup&&t.categoryGroup.forEach(function(e,t){""!=s()(e)&&a.push({value:r()(e)[0],label:s()(e)[0]})}),0!=a.length&&a.push({value:"all",label:"全部组"}),a.push({value:"categoryAll",label:"该厂区"}),e.selectOptions.push({value:t.zoneId,label:t.zoneName,children:a}))}),e.selectOptions.push({value:"",label:"全部厂区"}),e.getHistoryStatistic()}}).catch(function(){e.$root.Bus.$emit("showLoading",!1)})},numerialTypeChange:function(){this.rangeValueStart="",this.rangeValueEnd=""},numerialAreaChange:function(){this.$root.Bus.$emit("showLoading",!0),this.getHistoryStatistic()},timeChange:function(e){this.$root.Bus.$emit("showLoading",!0),""!=this.rangeValueStart&&""!=this.rangeValueEnd?this.$moment(this.rangeValueEnd).isAfter(this.rangeValueStart)?this.$moment(this.rangeValueEnd).diff(this.$moment(this.rangeValueStart))>172800306&&"datetime"==this.timeValue?("end"==e?this.rangeValueStart="":this.rangeValueEnd="",this.$message({type:"info",message:"请选择在两天之内的时间"}),this.$root.Bus.$emit("showLoading",!1)):this.$moment(this.rangeValueEnd).diff(this.$moment(this.rangeValueStart),"days")>30&&"date"==this.timeValue?("end"==e?this.rangeValueStart="":this.rangeValueEnd="",this.$message({type:"info",message:"请选择在30天之内的时间"}),this.$root.Bus.$emit("showLoading",!1)):this.$moment(this.rangeValueEnd).diff(this.$moment(this.rangeValueStart),"month")>24&&"month"==this.timeValue?("end"==e?this.rangeValueStart="":this.rangeValueEnd="",this.$message({type:"info",message:"请选择在2年之内的时间"}),this.$root.Bus.$emit("showLoading",!1)):this.$moment(this.rangeValueEnd).diff(this.$moment(this.rangeValueStart),"years")>10&&"year"==this.timeValue?("end"==e?this.rangeValueStart="":this.rangeValueEnd="",this.$message({type:"info",message:"请选择在10年之内的时间"}),this.$root.Bus.$emit("showLoading",!1)):this.getHistoryStatistic():("end"==e?this.rangeValueStart="":this.rangeValueEnd="",this.$root.Bus.$emit("showLoading",!1)):this.$root.Bus.$emit("showLoading",!1)},ifSendAjax:function(){var e={};switch(this.timeValue){case"datetime":e={zoneId:"",categoryId:"",timeType:"hour",startTime:this.$moment(this.rangeValueStart).format("YYYY-MM-DD HH"),endTime:this.$moment(this.rangeValueEnd).format("YYYY-MM-DD HH")};break;case"date":e={zoneId:"",categoryId:"",timeType:"day",startTime:this.$moment(this.rangeValueStart).format("YYYY-MM-DD"),endTime:this.$moment(this.rangeValueEnd).format("YYYY-MM-DD")};break;case"month":e={zoneId:"",categoryId:"",timeType:"month",startTime:this.$moment(this.rangeValueStart).format("YYYY-MM"),endTime:this.$moment(this.rangeValueEnd).format("YYYY-MM")};break;case"year":e={zoneId:"",categoryId:"",timeType:"year",startTime:this.$moment(this.rangeValueStart).format("YYYY"),endTime:this.$moment(this.rangeValueEnd).format("YYYY")}}return 1==this.areaValue.length&&""==this.areaValue[0]?e.zoneId="all":"categoryAll"==this.areaValue[1]?e.zoneId=this.areaValue[0]:this.areaValue[1].includes("-")?e.categoryId="all":e.categoryId=this.areaValue[1],""!=e.countUnit&&e},download:function(){var e=this.ifSendAjax();e&&(window.location.href=this.url+"lightStatistic/power/report/download?zoneId="+e.zoneId+"&categoryId="+e.categoryId+"&timeType="+e.timeType+"&startTime="+e.startTime+"&endTime="+e.endTime)},seriesNameFindIndex:function(e,t,a){return t.findIndex(function(t){return t[a]===e})},getHistoryStatistic:function(){var e=this,t=this.ifSendAjax();t&&function(e){return Object(d.e)(h+"lightStatistic/power/report",e)}(t).then(function(t){e.loading=!1,e.$root.Bus.$emit("showLoading",!1),e.tableDataReport=[],e.getHistoryCharts.clear(),"success"==t.resultCode?function(){e.tableDataReport=[].concat(i()(t.data)),e.option.xAxis.boundaryGap=!0,e.option.tooltip.axisPointer.type="shadow",e.option.grid.bottom="60px";var a=[],n=[],o=[];t.data.forEach(function(e,t){-1===n.indexOf(e.areaName)&&n.push(e.areaName),-1===a.indexOf(e.dateTime)&&a.push(e.dateTime)});for(var r=function(e){o[e]=[],a.forEach(function(a,i){t.data.forEach(function(t,i){a==t.dateTime&&n[e]==t.areaName&&o[e].push(t.energy)})})},l=0;l<n.length;l++)r(l);e.option.legend.data=[].concat(n),e.option.xAxis.data=[].concat(a),e.option.series=[];for(var s=0;s<o.length;s++)e.option.series.push({barGap:"30%",barMaxWidth:"18",itemStyle:{emphasis:{shadowBlur:2,opacity:1},normal:{barBorderRadius:[4,4,0,0]}},name:n[s],type:"bar",data:o[s],animationDuration:2e3,animationDelayUpdate:function(e){return 5*e}});e.getHistoryCharts.setOption(e.option),e.resizeGetHistoryCharts(),window.addEventListener("resize",e.resizeGetHistoryCharts)}():(e.option.xAxis.data=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],e.option.legend.data=[],e.option.series=[],e.getHistoryCharts.setOption(e.option),e.$message({type:"info",message:"统计报表暂无数据!"}))}).catch(function(){e.$root.Bus.$emit("showLoading",!1),e.loading=!1})},resizeGetHistoryCharts:function(){var e=this;setTimeout(function(){e.getHistoryCharts.resize()})}},mounted:function(){this.getFrom(),this.getHistoryCharts=c.a.init(document.getElementById("historyCharts")),this.getnumerialArea()},beforeDestroy:function(){window.removeEventListener("resize",this.resizeGetHistoryCharts),this.getHistoryCharts=null,null!=this.time&&(clearTimeout(this.time),this.time=null)}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"LightStatistics"},[e.show.area?a("div",{staticClass:"overview"},[e._m(0),e._v(" "),a("div",[a("el-table",{staticStyle:{width:"100%",padding:"30px 0"},attrs:{data:e.tableData,stripe:"","cell-style":e.cellStyleReport,"header-cell-style":e.headerStyleReport}},[a("el-table-column",{attrs:{prop:"areaName",label:"区域名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"deviceCount",label:"设备数量(个)"}}),e._v(" "),a("el-table-column",{attrs:{prop:"totalEnergy",label:"总耗能量(kW·h)"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n"+e._s(Math.ceil(1e3*t.row.totalEnergy)/1e3)+"\n")]}}],null,!1,375913732)}),e._v(" "),a("el-table-column",{attrs:{prop:"totalPower",label:"当前总功率(kW)"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n "+e._s(Math.ceil(1e3*t.row.totalPower)/1e3)+"\n")]}}],null,!1,122172121)})],1)],1)]):e._e(),e._v(" "),e.show.powerByConditon?a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"overview"},[a("div",{staticClass:"header"},[a("span",[e._v("统计报表")]),e._v(" "),a("div",{staticClass:"numerial"},[a("div",[a("el-cascader",{attrs:{options:e.selectOptions,id:"selectOptions","show-all-levels":!1},on:{change:e.numerialAreaChange},model:{value:e.areaValue,callback:function(t){e.areaValue=t},expression:"areaValue"}})],1),e._v(" "),a("div",[a("el-select",{attrs:{id:"timeValue",placeholder:"请选择"},on:{change:e.numerialTypeChange},model:{value:e.timeValue,callback:function(t){e.timeValue=t},expression:"timeValue"}},e._l(e.timeOptiion,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("div",[a("el-date-picker",{attrs:{align:"right","popper-class":"timeDateSet",clearable:e.clearable,id:"rangeValueStart",type:e.timeValue,placeholder:"起始时间","picker-options":e.pickerOptions},on:{change:function(t){return e.timeChange("start")}},model:{value:e.rangeValueStart,callback:function(t){e.rangeValueStart=t},expression:"rangeValueStart"}}),e._v(" "),a("el-date-picker",{attrs:{"popper-class":"timeDateSet",clearable:e.clearable,id:"rangeValueEnd",align:"right",type:e.timeValue,placeholder:"截止时间","picker-options":e.pickerOptions},on:{change:function(t){return e.timeChange("end")}},model:{value:e.rangeValueEnd,callback:function(t){e.rangeValueEnd=t},expression:"rangeValueEnd"}})],1),e._v(" "),a("div",[a("a",{ref:"download",attrs:{"href.prevent":"javaScript:void(0)"},on:{click:function(t){return t.preventDefault(),e.download(t)}}},[e._v("下载")])])])]),e._v(" "),a("div",[a("div",{attrs:{id:"historyCharts"}}),e._v(" "),a("div",{staticStyle:{width:"100%"},attrs:{id:"historyTable"}},[a("el-table",{attrs:{data:e.tableDataReport,stripe:"","cell-style":e.cellStyle,"header-cell-style":e.headerStyle,"max-height":"470"}},[a("el-table-column",{attrs:{prop:"areaName",label:"厂区"}}),e._v(" "),a("el-table-column",{attrs:{prop:"dateTime",label:"时间","min-width":"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"maxElec",label:"最大电流(A)"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n "+e._s(Math.ceil(1e3*t.row.maxElec)/1e3)+"\n")]}}],null,!1,1314547807)}),e._v(" "),a("el-table-column",{attrs:{prop:"minElec",label:"最小电流(A)"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n "+e._s(Math.ceil(1e3*t.row.minElec)/1e3)+"\n")]}}],null,!1,551655617)}),e._v(" "),a("el-table-column",{attrs:{prop:"maxVolt",label:"最大电压(v)"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n "+e._s(Math.ceil(1e3*t.row.maxVolt)/1e3)+"\n")]}}],null,!1,2906509329)}),e._v(" "),a("el-table-column",{attrs:{prop:"minVolt",label:"最小电压(V)"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n "+e._s(Math.ceil(1e3*t.row.minVolt)/1e3)+"\n")]}}],null,!1,566169231)}),e._v(" "),a("el-table-column",{attrs:{prop:"energy",label:"能耗(kW·h)"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v("\n "+e._s(Math.ceil(1e3*t.row.energy)/1e3)+"\n  ")])]}}],null,!1,1980750685)})],1)],1)])]):e._e()])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("p",{staticClass:"header"},[t("span",[this._v("区域表单")])])}]};var g=a("VU/8")(m,p,!1,function(e){a("uI+u")},null,null);t.default=g.exports},"uI+u":function(e,t){}});